generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model usuario {
  id          Int    @id @default(autoincrement())
  email       String @unique(map: "usuario_email_unique") @db.VarChar(100)
  telefone    String @db.VarChar(40)
  senha       String @db.VarChar(100)
  chave_senha String @db.VarChar(100)
}

model proprietario {
  id          Int           @id @default(autoincrement())
  registro    String        @db.VarChar
  cep         String        @db.VarChar
  endereco    String        @db.VarChar
  numero      String        @db.VarChar
  email       String        @unique(map: "email_proprietario") @db.VarChar
  nome        String?       @db.VarChar
  funcionario funcionario[]
  maquinario  maquinario[]
  propriedade propriedade[]
}

model area {
  id             Int           @id @default(autoincrement())
  nome           String        @db.VarChar(100)
  descricao      String?
  id_propriedade Int
  propriedade    propriedade   @relation(fields: [id_propriedade], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_area_propriedade")
  area_tarefa    area_tarefa[]
}

model area_tarefa {
  id        Int    @id @default(autoincrement())
  id_area   Int
  id_tarefa Int
  tarefa    tarefa @relation(fields: [id_tarefa], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_area_tarefa")
  area      area   @relation(fields: [id_area], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_area_tarefa_area")
}

model centro_custo {
  id             Int          @id @default(autoincrement())
  nome           String?      @db.VarChar(100)
  id_propriedade Int?
  propriedade    propriedade? @relation(fields: [id_propriedade], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "centro_custo_propriedade_fk")
  lancamento     lancamento[]
}

model fornecedor {
  id             Int          @id @default(autoincrement())
  nome           String?      @db.VarChar(100)
  email          String?      @db.VarChar(100)
  telefone       String?      @db.VarChar(100)
  id_propriedade Int?
  propriedade    propriedade? @relation(fields: [id_propriedade], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fornecedor_propriedade_fk")
  insumo         insumo[]
}

model funcionario {
  id                       Int           @id @default(autoincrement())
  nome                     String        @db.VarChar(100)
  email                    String?       @db.VarChar(100)
  conta_bancaria           String?       @db.VarChar(100)
  cpf                      String        @db.VarChar(100)
  pispasep                 String?       @db.VarChar(100)
  carteira_trabalho        String?       @db.VarChar(100)
  data_nascimento          DateTime?     @db.Date
  genero                   genero?
  certidao_nascimento      Bytes?
  comprovante_residencia   Bytes?
  comprovante_escolaridade Bytes?
  reservista               Bytes?
  id_proprietario          Int?
  id_propriedade           Int?
  proprietario             proprietario? @relation(fields: [id_proprietario], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_funcionario_proprietario")
  propriedade              propriedade?  @relation(fields: [id_propriedade], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "funcionario_propriedade_fk")
}

model insumo {
  id             Int          @id @default(autoincrement())
  nome           String       @db.VarChar(100)
  quantidade     Decimal?     @db.Decimal(12, 2)
  custo          Decimal?     @db.Decimal(12, 2)
  unidade_medida String?      @db.VarChar(100)
  id_propriedade Int?
  id_fornecedor  Int?
  fornecedor     fornecedor?  @relation(fields: [id_fornecedor], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_insumo_fornecedor")
  propriedade    propriedade? @relation(fields: [id_propriedade], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_insumo_propriedade")
}

model lancamento {
  id              Int             @id @default(autoincrement())
  valor           Decimal         @db.Decimal(12, 2)
  tipo_lancamento tipo_lancamento
  data_lancamento DateTime?       @default(now()) @db.Timestamp(6)
  id_propriedade  Int
  id_centro_custo Int?
  centro_custo    centro_custo?   @relation(fields: [id_centro_custo], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "fk_lancamento_centro_custo")
  propriedade     propriedade     @relation(fields: [id_propriedade], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_lancamento_propriedade")
}

model maquinario {
  id                Int           @id @default(autoincrement())
  modelo            String?       @db.VarChar(100)
  ano_fabricacao    Int?
  custo             Decimal       @db.Decimal(12, 2)
  tipo_custo        tipo_custo
  ultima_manutencao DateTime?     @db.Date
  alugado           Boolean?
  id_proprietario   Int?
  id_propriedade    Int?
  proprietario      proprietario? @relation(fields: [id_proprietario], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_maquinario_proprietario")
  propriedade       propriedade?  @relation(fields: [id_propriedade], references: [id], onDelete: NoAction, onUpdate: NoAction, map: "maquinario_propriedade_fk")
}

model produto {
  id             Int         @id @default(autoincrement())
  nome           String?     @db.VarChar(100)
  quantidade     Decimal?    @db.Decimal(12, 2)
  custo          Decimal?    @db.Decimal(12, 2)
  preco_venda    Decimal?    @db.Decimal(12, 2)
  id_propriedade Int
  propriedade    propriedade @relation(fields: [id_propriedade], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_produto_propriedade")
}

model propriedade {
  id              Int            @id @default(autoincrement())
  endereco        String?        @db.VarChar(100)
  gerente         String?        @db.VarChar(100)
  cnpj            String?        @db.VarChar(100)
  id_proprietario Int?
  area            area[]
  centro_custo    centro_custo[]
  fornecedor      fornecedor[]
  funcionario     funcionario[]
  insumo          insumo[]
  lancamento      lancamento[]
  maquinario      maquinario[]
  produto         produto[]
  proprietario    proprietario?  @relation(fields: [id_proprietario], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_propriedade_proprietario")
  tarefa          tarefa[]
}

model recurso_tarefa {
  id                Int          @id @default(autoincrement())
  id_recurso        Int
  tipo_recurso      tipo_recurso
  quantidade        Int?
  status_lancamento Boolean?     @default(false)
  id_tarefa         Int
  tarefa            tarefa       @relation(fields: [id_tarefa], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_recurso_tarefa")
}

model tarefa {
  id             Int               @id @default(autoincrement())
  titulo         String            @db.VarChar(100)
  descricao      String?
  data_inicio    DateTime?         @db.Date
  dias_uteis     Int?
  horas_trabalho Int?
  status         status_tarefa
  prioridade     prioridade_tarefa
  tarefa_pai     Int?
  id_propriedade Int
  area_tarefa    area_tarefa[]
  recurso_tarefa recurso_tarefa[]
  propriedade    propriedade       @relation(fields: [id_propriedade], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_tarefa_propriedade")
}

enum genero {
  masculino
  feminino
}

enum prioridade_tarefa {
  baixa
  media
  alta
  urgente
}

enum status_tarefa {
  a_fazer   @map("a fazer")
  fazendo
  validando
  entregue
}

enum tipo_custo {
  hora
  diario
  mensal
}

enum tipo_lancamento {
  entrada
  saida
}

enum tipo_recurso {
  maquinario
  funcionario
  insumo
}
